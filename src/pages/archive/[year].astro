---
import { getCollection } from 'astro:content';
import BaseLayout from '@layouts/base.astro';
import MediaList from '@components/MediaList.astro';
const books = await getCollection('books');


// 1. This function tells Astro which pages to build
export async function getStaticPaths() {
  const allBooks = await getCollection('books');

  // Filter for 'read' books with valid dates
  const readBooks = allBooks.filter(b => b.data.shelf === 'read' && b.data.end_date);

  // Get unique list of years
  const years = [...new Set(readBooks.map(b => {
    const d = new Date(b.data.end_date);
    return isNaN(d.getFullYear()) ? null : d.getFullYear();
  }))].filter(Boolean).sort();

  // DEBUG LOG
    console.log("Generated Years:", years);

  // Return an array of objects: one for each year
  return years.map(year => {
    const yearStr = year!.toString();
    const filteredBooks = readBooks.filter(b =>
      new Date(b.data.end_date).getFullYear() === year
    );

    return {
      params: { year: yearStr }, // This becomes the URL: /archive/2025
      props: { books: filteredBooks } // This passes the books to the page
    };
  });
}

// 2. Grab the data for the current page
const { year } = Astro.params;
const { books: filteredBooks } = Astro.props; // Rename 'books' to 'filteredBooks' here
---

<BaseLayout>
  <header class="archive-header">
    <a href="/archive" class="back-link">‚Üê All Years</a>
    <h1>Yearly Log: <span class="accent">{year}</span></h1>
    <p class="stats">{books.length} entries recovered from the archives.</p>
    <MediaList items={filteredBooks} />

  </header>
</BaseLayout>

<style>
  .archive-header {
    margin-bottom: 3rem;
    border-bottom: 1px solid var(--accent-200);
    padding-bottom: 1rem;
  }
  .accent {
    color: var(--accent-color);
    font-family: monospace;
  }
  .back-link {
    font-size: 0.8rem;
    text-decoration: none;
    color: var(--accent-400);
  }
</style>
