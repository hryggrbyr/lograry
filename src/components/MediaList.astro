---
import BookCard from './BookCard.astro';
import MovieCard from './MovieCard.astro';
import SeriesCard from './SeriesCard.astro';

interface Props {
  items: any[];
}

// Map your YAML 'type' strings to the actual Astro Components
const components = {
  book: BookCard,
  movie: MovieCard,
  series: SeriesCard,
};

const { items } = Astro.props;
const shelves = [...new Set(items.map(x => x.data.shelf))].sort();
// Sort by sort_title alphabetically (A-Z)
// We use localeCompare to handle numbers and special characters correctly
const sortedItems = [...items].sort((a, b) => {
  const titleA = a.data.sort_title || a.data.title || "";
  const titleB = b.data.sort_title || b.data.title || "";
  return titleA.localeCompare(titleB, undefined, { sensitivity: 'base' });
});
---

<section class="media-container flow">
  <div class="filter-controls">
    <button class="filter-btn active" data-filter="all">All</button>
    {shelves.map(shelf => (
    <button class="filter-btn" data-filter={shelf}>{shelf}</button>
    ))}
    <button class="filter-btn" data-filter="wishlist">Wishlist</button>
  </div>

  <div class="media-list flow" data-active-filter="all">
    {sortedItems.map((item, index) => {
      // Determine the type from YAML, fallback to 'book'
      const itemType = item.data.type || 'book';
      const Card = components[itemType as keyof typeof components] || BookCard;
      return (
        <Card item={item} num={index} />
      );
    })}
  </>
</section>
<script lang="ts">
  const buttons = document.querySelectorAll(".filter-btn");
  const list = document.querySelector("[data-active-filter]");

  buttons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const filter = btn.getAttribute("data-filter");

      // Update button UI
      buttons.forEach((b) => b.classList.remove("active"));
      btn.classList.add("active");

      // Filter cards
      list.dataset.activeFilter = filter;
    });
  });
</script>
